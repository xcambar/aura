/*!
   * Helper function that returns the first function found among its arguments.
   * If no function if found, it return a noop (empty function).
   *
   * @return {[type]} [description]
   */

/*!
   * If the value of the first argument is a function then invoke
   * it with the rest of the args, otherwise, return it.
   */

/*!
  * Actual extension loading.
  *
  * The sequence is:
  *
  * * resolves the extension reference
  * * register and requires its dependencies if any
  * * init the extension
  *
  * This method also returns a promise that allows
  * to keep track of the app's loading sequence.
  *
  * If the extension provides a `afterAppStart` method,
  * the promise will resolve to that function that
  * will be called at the end of the app loading sequence.
  *
  * @param {String|Object|Function} extDef the reference and context of the extension
  */

/*!
  * Extension resolution before actual loading.
  * If `ext` is a String, it is considered as a reference
  * to an AMD module that has to be loaded.
  *
  * This method returns a promise that resolves to the actual extension,
  * With all its dependencies already required' too.
  *
  * @param {String|Object|Function} ext the reference of the extension
  * @param {Object} context the thing this extension is supposed to extend
  */

define("aura/platform",[],function(){typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),typeof Array.isArray!="function"&&(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),Object.create||(Object.create=function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(i){if(typeof i!="object"&&typeof i!="function"||i===null)throw new TypeError("Object.keys called on non-object");var s=[];for(var o in i)e.call(i,o)&&s.push(o);if(t)for(var u=0;u<r;u++)e.call(i,n[u])&&s.push(n[u]);return s}}())}),function(){var e={require:{paths:{underscore:"components/underscore/underscore",jquery:"components/jquery/jquery"},shim:{underscore:{exports:"_"},jquery:{exports:"$"}}}};require.config(e.require),window.jQuery&&define("jquery",[],function(){return window.jQuery}),define("aura/base",["module","underscore","jquery","./platform"],function(e,t,n){var r=window.console||{};require.s.contexts._.config.paths.aura||require.config({paths:{aura:e.id.replace(/base$/,"")}});var i={};i.dom={find:function(e,t){return t=t||document,n(t).find(e)},data:function(e,t){return n(e).data(t)}},i.data={deferred:n.Deferred,when:n.when},i.util={each:n.each,extend:n.extend,uniq:t.uniq,_:t,decamelize:function(e,t){return t=t===undefined?"_":t,e.replace(/([A-Z])/g,t+"$1").toLowerCase()}};var s=function(){};return i.log=function(){return r.log&&r.log(arguments)},i.events={listen:function(e,t,r,i){return n(e).on(t,r,i)},bindAll:function(){return t.bindAll.apply(this,arguments)}},i.template={parse:t.template},i})}(),define("aura/aura.extensions",["./base"],function(e){function s(){return this._extensions=[],this.initStatus=r(),this}function o(){var e=n.call(arguments),t;for(var r=0,i=e.length;r<i;r++){t=e[r];if(typeof t=="function")return t}return function(){}}function u(e){return typeof e=="function"?e.apply(undefined,n.call(arguments,1)):e}function a(e){var t=r(),n=e.ref,s=e.context,u=f(n,s);return u.fail(t.reject),u.done(function(e){if(!e)return t.resolve();var n;try{n=o(e,e.initialize)(s)}catch(r){t.reject(r)}var u=i(n);u.done(function(){t.resolve(e)}),u.fail(t.reject)}),t.promise()}function f(e,t){var n=r(),i=function(e){try{e=u(e,t);if(e&&e.require&&e.require.paths){var r=Object.keys(e.require.paths)||[];require.config(e.require),require(r,function(){n.resolve(e)},s)}else n.resolve(e)}catch(i){s(i)}},s=function(t){console.error("Error loading ext:",e,t),n.reject(t)};return typeof e=="string"?require([e],i,s):i(e),n}var t=e.util._,n=Array.prototype.slice,r=e.data.deferred,i=e.data.when;return s.prototype.add=function(e){if(t.include(this._extensions,e)){var n=e.ref.toString()+" is already registered.";throw n+="Extensions can only be added once.",new Error(n)}if(this.initStarted)throw new Error("Init extensions already called");return this._extensions.push(e),this},s.prototype.onReady=function(e){return this.initStatus.then(e),this},s.prototype.onFailure=function(e){return this.initStatus.fail(e),this},s.prototype.init=function(){if(this.initStarted)throw new Error("Init extensions already called");this.initStarted=!0;var e=t.compact(this._extensions.slice(0)),n=[],r=this.initStatus;return function s(t){if(t){var o=a(t);n.push(o),o.done(function(){s(e.shift())}),o.fail(function(e){e||(e="Unknown error while loading an extension"),e instanceof Error||(e=new Error(e)),r.reject(e)})}else e.length===0&&i.apply(undefined,n).done(function(){r.resolve(Array.prototype.slice.call(arguments))})}(e.shift()),r.promise()},s}),define("aura/aura",["./base","./aura.extensions"],function(e,t){function s(r){return this instanceof s?(this.ref=n.uniqueId("aura_"),this.config=r=r||{},this.extensions=new t,this.core=Object.create(e),this.sandbox=Object.create(e),this.sandboxes={},r.debug&&this.use("aura/ext/debug"),this.use("aura/ext/mediator"),r.widgets=r.widgets||{},r.widgets.sources=r.widgets.sources||{"default":"widgets"},this.use("aura/ext/widgets"),this):new s(r)}var n=e.util._,r=function(){},i=Object.freeze||r;return s.prototype.createSandbox=function(){var e=Object.create(this.sandbox);return e.ref=n.uniqueId("sandbox-"),this.sandboxes[e.ref]=e,e},s.prototype.getSandbox=function(e){return this.sandboxes[e]},s.prototype.use=function(e){return this.extensions.add({ref:e,context:this}),this},s.prototype.registerWidgetsSource=function(e,t){if(this.config.widgets.sources[e])throw new Error("Widgets source '"+e+"' is already registered");return this.config.widgets.sources[e]=t,this},s.prototype.start=function(t){var n=this;return n.started?(console.error("Aura already started... !"),n.extensions.initStatus):(n.startOptions=t||{},n.started=!0,n.extensions.onReady(function(t){e.util.each(t,function(e,t){if(t&&typeof t.afterAppStart=="function")try{t.afterAppStart(n)}catch(r){console.error("Error on ",t.name||t,".afterAppStart callback: (",r.message,")",r)}})}),n.extensions.onFailure(function(){console.error("Error initializing app...",n.config.name,arguments),n.stop()}),n.extensions.init())},s.prototype.stop=function(){this.started=!1},s}),define("aura/ext/debug",[],function(){return{name:"debug",initialize:function(e){}}}),!function(e,t){function i(){this._events={},this._conf&&s.call(this,this._conf)}function s(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function o(e){this._events={},this.newListener=!1,s.call(this,e)}function u(e,t,n,r){if(!n)return[];var i=[],s,o,a,f,l,c,h,p=t.length,d=t[r],v=t[r+1];if(r===p&&n._listeners){if(typeof n._listeners=="function")return e&&e.push(n._listeners),[n];for(s=0,o=n._listeners.length;s<o;s++)e&&e.push(n._listeners[s]);return[n]}if(d==="*"||d==="**"||n[d]){if(d==="*"){for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(i=i.concat(u(e,t,n[a],r+1)));return i}if(d==="**"){h=r+1===p||r+2===p&&v==="*",h&&n._listeners&&(i=i.concat(u(e,t,n,p)));for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(a==="*"||a==="**"?(n[a]._listeners&&!h&&(i=i.concat(u(e,t,n[a],p))),i=i.concat(u(e,t,n[a],r))):a===v?i=i.concat(u(e,t,n[a],r+2)):i=i.concat(u(e,t,n[a],r)));return i}i=i.concat(u(e,t,n[d],r+1))}f=n["*"],f&&u(e,t,f,r+1),l=n["**"];if(l)if(r<p){l._listeners&&u(e,t,l,p);for(a in l)a!=="_listeners"&&l.hasOwnProperty(a)&&(a===v?u(e,t,l[a],r+2):a===d?u(e,t,l[a],r+1):(c={},c[a]=l[a],u(e,t,{"**":c},r+1)))}else l._listeners?u(e,t,l,p):l["*"]&&l["*"]._listeners&&u(e,t,l["*"],p);return i}function a(e,t){e=typeof e=="string"?e.split(this.delimiter):e.slice();for(var i=0,s=e.length;i+1<s;i++)if(e[i]==="**"&&e[i+1]==="**")return;var o=this.listenerTree,u=e.shift();while(u){o[u]||(o[u]={}),o=o[u];if(e.length===0){if(!o._listeners)o._listeners=t;else if(typeof o._listeners=="function")o._listeners=[o._listeners,t];else if(n(o._listeners)){o._listeners.push(t);if(!o._listeners.warned){var a=r;typeof this._events.maxListeners!="undefined"&&(a=this._events.maxListeners),a>0&&o._listeners.length>a&&(o._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",o._listeners.length),console.trace())}}return!0}u=e.shift()}return!0}var n=Array.isArray?Array.isArray:function(t){return Object.prototype.toString.call(t)==="[object Array]"},r=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},o.prototype.event="",o.prototype.once=function(e,t){return this.many(e,1,t),this},o.prototype.many=function(e,t,n){function i(){--t===0&&r.off(e,i),n.apply(this,arguments)}var r=this;if(typeof n!="function")throw new Error("many only accepts instances of Function");return i._origin=n,this.on(e,i),r},o.prototype.emit=function(){this._events||i.call(this);var e=arguments[0];if(e==="newListener"&&!this.newListener&&!this._events.newListener)return!1;if(this._all){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];for(r=0,t=this._all.length;r<t;r++)this.event=e,this._all[r].apply(this,n)}if(e==="error"&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var o=typeof e=="string"?e.split(this.delimiter):e.slice();u.call(this,s,o,this.listenerTree,0)}else s=this._events[e];if(typeof s=="function"){this.event=e;if(arguments.length===1)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];s.apply(this,n)}return!0}if(s){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];var a=s.slice();for(var r=0,t=a.length;r<t;r++)this.event=e,a[r].apply(this,n);return a.length>0||this._all}return this._all},o.prototype.on=function(e,t){if(typeof e=="function")return this.onAny(e),this;if(typeof t!="function")throw new Error("on only accepts instances of Function");this._events||i.call(this),this.emit("newListener",e,t);if(this.wildcard)return a.call(this,e,t),this;if(!this._events[e])this._events[e]=t;else if(typeof this._events[e]=="function")this._events[e]=[this._events[e],t];else if(n(this._events[e])){this._events[e].push(t);if(!this._events[e].warned){var s=r;typeof this._events.maxListeners!="undefined"&&(s=this._events.maxListeners),s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}return this},o.prototype.onAny=function(e){this._all||(this._all=[]);if(typeof e!="function")throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(e,t){if(typeof t!="function")throw new Error("removeListener only takes instances of Function");var r,i=[];if(this.wildcard){var s=typeof e=="string"?e.split(this.delimiter):e.slice();i=u.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],i.push({_listeners:r})}for(var o=0;o<i.length;o++){var a=i[o];r=a._listeners;if(n(r)){var f=-1;for(var l=0,c=r.length;l<c;l++)if(r[l]===t||r[l].listener&&r[l].listener===t||r[l]._origin&&r[l]._origin===t){f=l;break}if(f<0)return this;this.wildcard?a._listeners.splice(f,1):this._events[e].splice(f,1),r.length===0&&(this.wildcard?delete a._listeners:delete this._events[e])}else if(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)this.wildcard?delete a._listeners:delete this._events[e]}return this},o.prototype.offAny=function(e){var t=0,n=0,r;if(e&&this._all&&this._all.length>0){r=this._all;for(t=0,n=r.length;t<n;t++)if(e===r[t])return r.splice(t,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(e){if(arguments.length===0)return!this._events||i.call(this),this;if(this.wildcard){var t=typeof e=="string"?e.split(this.delimiter):e.slice(),n=u.call(this,null,t,this.listenerTree,0);for(var r=0;r<n.length;r++){var s=n[r];s._listeners=null}}else{if(!this._events[e])return this;this._events[e]=null}return this},o.prototype.listeners=function(e){if(this.wildcard){var t=[],r=typeof e=="string"?e.split(this.delimiter):e.slice();return u.call(this,t,r,this.listenerTree,0),t}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.listenersAny=function(){return this._all?this._all:[]},typeof define=="function"&&define.amd?define("eventemitter",[],function(){return o}):e.EventEmitter2=o}(typeof process!="undefined"&&typeof process.title!="undefined"&&typeof exports!="undefined"?exports:window),define("aura/ext/mediator",["eventemitter","underscore"],function(){return{name:"mediator",require:{paths:{eventemitter:"components/eventemitter2/lib/eventemitter2",underscore:"components/underscore/underscore"},shim:{underscore:{exports:"_"}}},initialize:function(e){var t=require("eventemitter"),n=require("underscore");e.config.mediator=n.defaults(e.config.mediator||{},{wildcard:!0,delimiter:".",newListener:!0,maxListeners:20});var r=new t(e.config.mediator);e.core.mediator=r,e.sandbox.on=function(e,t){this._events=this._events||[],this._events.push({name:e,listener:t}),r.on(e,t)},e.sandbox.off=function(e,t){if(!this._events)return;this._events=n.reject(this._events,function(n){return n.name===e&&n.listener===t}),r.off(e,t)},e.sandbox.emit=function(){r.emit.apply(r,arguments)},e.sandbox.stopListening=function(){if(!this._events)return;n.each(this._events,function(e){r.off(e.name,e.listener)})};var i=["aura","sandbox","stop"].join(e.config.mediator.delimiter);e.core.mediator.on(i,function(e){e.stopListening()})}}}),define("aura/ext/widgets",[],function(){return function(e){function i(e){return this.options=e,this._ref=e._ref,this.$el=t.dom.find(e.el),this.initialize.call(this,e),this}function o(n,r){var i={el:n,require:{}},s,o,u=t.dom.data(n);t.util.each(u,function(e,n){e=e.replace(new RegExp("^"+r),""),e=e.charAt(0).toLowerCase()+e.slice(1);if(e!=="widget")i[e]=n;else{var u=n.split("@");s=t.util.decamelize(u[0]),o=u[1]||"default"}});var a=require.s.contexts._,f=e.config.widgets.sources[o]||"widgets";return i.ref="__widget__$"+s+"@"+o,i.baseUrl=f+"/"+s,i.require=i.require||{},i.require.packages=i.require.packages||[],i.require.packages.push({name:i.ref,location:f+"/"+s}),i.name=s,i}var t=e.core;t.Widgets=t.Widgets||{};var n=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r={};i.prototype.initialize=function(){},i.prototype.html=function(e){var t=this.$el;return t.html(e),this.sandbox.start(t),this};var s=function(e,r){var i=this,s;e&&n(e,"constructor")?s=e.constructor:s=function(){i.apply(this,arguments)},t.util.extend(s,i,r);var o=function(){this.constructor=s};return o.prototype=i.prototype,s.prototype=new o,e&&t.util.extend(s.prototype,e),s.__super__=i.prototype,s};return i.extend=s,i.load=function(n,s){var o=t.data.deferred(),u=s.ref,a,f;return o.fail(function(e){console.error("Error loading widget ",n,e)}),require.config(s.require),require([s.ref],function(n){if(!n)return o.reject("widget "+s.ref+" Definition is empty !");try{if(r[u])f=r[u];else{n.type?f=t.Widgets[n.type]:f=i;if(!f)throw new Error("Can't find widget of type '"+n.type+"', did you forget to include the extension that provides it ?");t.util._.isObject(n)&&(f=r[u]=f.extend(n))}var a=e.createSandbox();s._ref=t.util._.uniqueId(u+"+");var l={sandbox:a};typeof n=="function"&&(l.initialize=n),f=f.extend(l);var c=new f(s),h=t.data.when(c);return h.then(function(e){o.resolve(e)}),h.fail(function(e){o.reject(e)}),h}catch(p){console.error(p.message),o.reject(p)}},function(e){o.reject(e)}),o.promise()},i.parseList=function(n){if(Array.isArray(n))return n;var r=[];if(n&&t.dom.find(n)){var i=e.config.namespace,s=["[data-aura-widget]"];i&&s.push("[data-"+i+"-widget]"),s=s.join(","),t.dom.find(s,n||"body").each(function(){var e="aura";i&&this.getAttribute("data-"+i+"-widget")&&(e=i);var t=o(this,e);r.push({name:t.name,options:t})})}return r},i.startAll=function(e){var n=i.parseList(e),r=[];return t.util.each(n,function(e,t){r.push(i.load(t.name,t.options))}),t.data.when.apply(undefined,r)},{name:"widgets",require:{paths:{text:"components/requirejs-text/text"}},initialize:function(e){e.core.Widgets.Base=i,e.core.registerWidgetType=function(t,n){if(e.core.Widgets[t])throw new Error("Widget type "+t+" already defined");e.core.Widgets[t]=i.extend(n)},e.core.start=i.startAll,e.sandbox.start=function(t){var n=["aura","sandbox","start"].join(e.config.mediator.delimiter);e.core.mediator.emit(n,this),_.invoke(this._children||[],"stop");var r=this;return i.startAll(t).then(function(){var e=Array.prototype.slice.call(arguments),t=[];_.each(e,function(e){e.sandbox._widget=e,e.sandbox._parent=r,t.push(e.sandbox)}),r._children=t}),this},e.sandbox.stop=function(){var t=["aura","sandbox","stop"].join(e.config.mediator.delimiter);return _.invoke(this._children,"stop"),e.core.mediator.emit(t,this),this.stopped=!0,delete e.sandboxes[this.ref],this}},afterAppStart:function(e){e.startOptions.widgets&&e.core.start(e.startOptions.widgets)}}}});